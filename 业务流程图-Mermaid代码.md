# 体育馆场地预约系统业务流程图（泳道图）

## 图3.1 用户预约场地业务流程图

```mermaid
graph TB
    subgraph 用户
        A1([开始])
        A2[登录系统]
        A3[浏览场馆列表]
        A4[选择场馆]
        A5[查看场地信息]
        A6[选择预约日期]
        A7[选择时间段]
        A8[填写预约信息]
        A9{是否使用优惠券?}
        A10[选择优惠券]
        A11[确认订单]
        A12[选择支付方式]
        A13[完成支付]
        A14{支付成功?}
        A15[查看预约结果]
        A16([结束])
    end
    
    subgraph 小程序
        B1[显示登录页面]
        B2[显示场馆列表]
        B3[显示场地详情]
        B4[显示可用时间段]
        B5[显示预约表单]
        B6[显示优惠券列表]
        B7[显示订单确认页]
        B8[调用支付接口]
        B9[显示支付结果]
        B10[显示预约成功页]
    end
    
    subgraph 后台系统
        C1[验证用户身份]
        C2[查询场馆数据]
        C3[查询场地数据]
        C4[查询时间段状态]
        C5[验证预约信息]
        C6[查询用户优惠券]
        C7[计算订单金额]
        C8[生成预约订单]
        C9[处理支付请求]
        C10[更新订单状态]
        C11[更新时间段状态]
        C12[发送通知消息]
    end
    
    A1 --> A2
    A2 --> B1
    B1 --> C1
    C1 --> A3
    A3 --> B2
    B2 --> C2
    C2 --> A4
    A4 --> A5
    A5 --> B3
    B3 --> C3
    C3 --> A6
    A6 --> A7
    A7 --> B4
    B4 --> C4
    C4 --> A8
    A8 --> B5
    B5 --> C5
    C5 --> A9
    A9 -->|是| A10
    A10 --> B6
    B6 --> C6
    C6 --> A11
    A9 -->|否| A11
    A11 --> B7
    B7 --> C7
    C7 --> C8
    C8 --> A12
    A12 --> A13
    A13 --> B8
    B8 --> C9
    C9 --> A14
    A14 -->|否| A13
    A14 -->|是| C10
    C10 --> C11
    C11 --> C12
    C12 --> B9
    B9 --> A15
    A15 --> B10
    B10 --> A16
```

## 图3.2 场馆管理业务流程图

```mermaid
graph TB
    subgraph 管理员
        A1([开始])
        A2[登录管理后台]
        A3[进入场馆管理]
        A4{选择操作}
        A5[点击新增场馆]
        A6[填写场馆信息]
        A7[上传场馆图片]
        A8[提交表单]
        A9[选择要编辑的场馆]
        A10[修改场馆信息]
        A11[提交修改]
        A12[选择要删除的场馆]
        A13{确认删除?}
        A14[查看操作结果]
        A15([结束])
    end
    
    subgraph 管理后台
        B1[显示登录页面]
        B2[显示场馆列表]
        B3[显示新增表单]
        B4[显示图片上传组件]
        B5[显示提交确认]
        B6[加载场馆详情]
        B7[显示编辑表单]
        B8[显示修改确认]
        B9[显示删除确认对话框]
        B10[显示操作成功提示]
    end
    
    subgraph 后台系统
        C1[验证管理员权限]
        C2[查询场馆列表数据]
        C3[验证表单数据]
        C4[保存图片文件]
        C5[保存场馆信息]
        C6[记录操作日志]
        C7[查询场馆详情]
        C8[验证修改数据]
        C9[更新场馆信息]
        C10[检查关联数据]
        C11{是否有关联场地?}
        C12{是否有未完成预约?}
        C13[删除场馆数据]
        C14[删除相关文件]
    end
    
    A1 --> A2
    A2 --> B1
    B1 --> C1
    C1 --> A3
    A3 --> B2
    B2 --> C2
    C2 --> A4
    
    A4 -->|新增| A5
    A5 --> B3
    B3 --> A6
    A6 --> A7
    A7 --> B4
    B4 --> C4
    C4 --> A8
    A8 --> B5
    B5 --> C3
    C3 --> C5
    C5 --> C6
    C6 --> B10
    B10 --> A14
    
    A4 -->|编辑| A9
    A9 --> B6
    B6 --> C7
    C7 --> A10
    A10 --> B7
    B7 --> A11
    A11 --> B8
    B8 --> C8
    C8 --> C9
    C9 --> C6
    
    A4 -->|删除| A12
    A12 --> B9
    B9 --> C10
    C10 --> C11
    C11 -->|是| B10
    C11 -->|否| C12
    C12 -->|是| B10
    C12 -->|否| A13
    A13 -->|是| C13
    A13 -->|否| A14
    C13 --> C14
    C14 --> C6
    
    A14 --> A15
```

## 图3.3 预约管理业务流程图

```mermaid
graph TB
    subgraph 管理员
        A1([开始])
        A2[登录管理后台]
        A3[进入预约管理]
        A4{选择操作}
        A5[设置筛选条件]
        A6[查看预约列表]
        A7[查看预约详情]
        A8[选择要取消的预约]
        A9[填写取消原因]
        A10{确认取消?}
        A11[选择退款申请]
        A12[审核退款信息]
        A13[确认退款金额]
        A14{确认退款?}
        A15[查看处理结果]
        A16([结束])
    end
    
    subgraph 管理后台
        B1[显示登录页面]
        B2[显示预约管理页面]
        B3[显示筛选条件组件]
        B4[显示预约列表]
        B5[显示预约详情页]
        B6[显示取消确认对话框]
        B7[显示取消成功提示]
        B8[显示退款申请列表]
        B9[显示退款详情]
        B10[显示退款确认对话框]
        B11[显示处理结果]
    end
    
    subgraph 后台系统
        C1[验证管理员权限]
        C2[查询预约数据]
        C3[应用筛选条件]
        C4[返回预约列表]
        C5[查询预约详情]
        C6[检查预约状态]
        C7{状态是否允许取消?}
        C8[更新预约状态]
        C9{是否已支付?}
        C10[发起退款流程]
        C11[释放时间段]
        C12[发送取消通知]
        C13[查询退款申请]
        C14[查询原订单信息]
        C15[调用支付接口]
        C16{退款是否成功?}
        C17[更新支付状态]
        C18[记录退款流水]
        C19[发送退款通知]
        C20[记录操作日志]
    end
    
    A1 --> A2
    A2 --> B1
    B1 --> C1
    C1 --> A3
    A3 --> B2
    B2 --> C2
    C2 --> A4
    
    A4 -->|查询| A5
    A5 --> B3
    B3 --> C3
    C3 --> A6
    A6 --> B4
    B4 --> C4
    C4 --> A7
    A7 --> B5
    B5 --> C5
    C5 --> A15
    
    A4 -->|取消| A8
    A8 --> B6
    B6 --> C6
    C6 --> C7
    C7 -->|否| B7
    C7 -->|是| A9
    A9 --> A10
    A10 -->|否| A15
    A10 -->|是| C8
    C8 --> C9
    C9 -->|否| C11
    C9 -->|是| C10
    C10 --> C11
    C11 --> C12
    C12 --> C20
    C20 --> B7
    B7 --> A15
    
    A4 -->|退款| A11
    A11 --> B8
    B8 --> C13
    C13 --> A12
    A12 --> B9
    B9 --> C14
    C14 --> A13
    A13 --> A14
    A14 -->|否| A15
    A14 -->|是| B10
    B10 --> C15
    C15 --> C16
    C16 -->|否| B11
    C16 -->|是| C17
    C17 --> C18
    C18 --> C19
    C19 --> C20
    C20 --> B11
    B11 --> A15
    
    A15 --> A16
```

## 使用说明

### 泳道图说明
每个流程图都分为三个泳道（Swimlane）：
1. **用户/管理员泳道**：展示用户或管理员的操作行为
2. **小程序/管理后台泳道**：展示前端界面的交互和显示
3. **后台系统泳道**：展示后端的业务逻辑处理

### 方法1：在线渲染（推荐）
1. 访问 https://mermaid.live/
2. 复制上面的Mermaid代码
3. 粘贴到编辑器中
4. 调整样式和布局
5. 导出为PNG或SVG格式

### 方法2：使用Draw.io绘制
如果Mermaid渲染效果不理想，建议使用Draw.io手动绘制：
1. 访问 https://app.diagrams.net/
2. 选择"泳道图"模板
3. 创建三个泳道：用户/管理员、小程序/管理后台、后台系统
4. 根据Mermaid代码中的流程手动绘制

### 方法3：使用ProcessOn
1. 访问 https://www.processon.com/
2. 新建"跨职能流程图"
3. 创建三个泳道
4. 参考Mermaid代码绘制流程

### 方法4：使用Visio
1. 打开Microsoft Visio
2. 选择"跨职能流程图"模板
3. 创建三个泳道
4. 绘制完整流程

## 流程图详细说明

### 图3.1 用户预约场地业务流程图
**泳道分工：**
- **用户泳道**：用户的操作步骤，从登录到完成支付
- **小程序泳道**：小程序界面的展示和交互
- **后台系统泳道**：后端的数据处理和业务逻辑

**关键流程：**
1. 用户登录 → 身份验证
2. 浏览场馆 → 查询数据 → 展示列表
3. 选择时间 → 检查可用性 → 显示时间段
4. 填写信息 → 验证数据 → 生成订单
5. 完成支付 → 处理支付 → 更新状态

### 图3.2 场馆管理业务流程图
**泳道分工：**
- **管理员泳道**：管理员的操作步骤
- **管理后台泳道**：管理后台界面的展示
- **后台系统泳道**：后端的数据处理和权限验证

**关键流程：**
1. 新增场馆：填写信息 → 上传图片 → 保存数据
2. 编辑场馆：加载数据 → 修改信息 → 更新数据
3. 删除场馆：检查关联 → 确认删除 → 删除数据

### 图3.3 预约管理业务流程图
**泳道分工：**
- **管理员泳道**：管理员的操作步骤
- **管理后台泳道**：管理后台界面的展示
- **后台系统泳道**：后端的业务处理和状态更新

**关键流程：**
1. 查询预约：设置条件 → 筛选数据 → 展示结果
2. 取消预约：检查状态 → 填写原因 → 处理退款
3. 退款处理：审核申请 → 调用接口 → 更新状态

## 绘图建议

### 使用Draw.io绘制步骤：
1. **创建泳道**
   - 插入 → 高级 → 跨职能流程图
   - 设置3个垂直泳道
   - 命名：用户/管理员、小程序/管理后台、后台系统

2. **绘制流程**
   - 使用圆角矩形表示操作步骤
   - 使用菱形表示判断节点
   - 使用箭头连接各个节点
   - 跨泳道的箭头表示交互

3. **美化样式**
   - 统一颜色方案
   - 调整节点大小
   - 对齐元素
   - 添加图例说明

### 样式建议：
- **用户/管理员泳道**：浅蓝色背景
- **小程序/管理后台泳道**：浅绿色背景
- **后台系统泳道**：浅黄色背景
- **操作节点**：白色填充，蓝色边框
- **判断节点**：白色填充，橙色边框
- **箭头**：黑色实线，带箭头
